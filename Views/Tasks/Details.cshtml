@model EmployeeTaskManager.Models.TaskItem
@using EmployeeTaskManager.Models

@{
    ViewData["Title"] = "Task Details";
}

<h2 class="mb-3">Task Details</h2>
<hr />

<dl class="row">
    <dt class="col-sm-3">Title</dt>
    <dd class="col-sm-9">@Model.Title</dd>

    <dt class="col-sm-3">Description</dt>
    <dd class="col-sm-9">@Model.Description</dd>

    <dt class="col-sm-3">Due Date</dt>
    <dd class="col-sm-9">@Model.DueDate?.ToShortDateString()</dd>

    <dt class="col-sm-3">Status</dt>
    <dd class="col-sm-9">
        <span class="badge @(Model.Status switch {
            EmployeeTaskManager.Models.TaskStatus.Pending => "bg-warning text-dark",
            EmployeeTaskManager.Models.TaskStatus.InProgress => "bg-info text-dark",
            EmployeeTaskManager.Models.TaskStatus.Completed => "bg-success",
            _ => "bg-secondary"
        })">
            @Model.Status
        </span>
    </dd>

    @* Allow Employees to update only THEIR OWN task *@
    @if(User.IsInRole("Admin") == false && Model.Employee?.Email == User.Identity?.Name)
{
    <form asp-action="ChangeStatus" method="post">
        <select name="status" class="form-select form-select-sm w-auto d-inline">
            <option value="Pending">Pending</option>
            <option value="InProgress">In Progress</option>
            <option value="Completed">Completed</option>
        </select>
        <button type="submit" class="btn btn-sm btn-primary">Update</button>
    </form>
}


    <dt class="col-sm-3">Employee</dt>
    <dd class="col-sm-9">@Model.Employee?.Name</dd>

    <dt class="col-sm-3">Priority</dt>
    <dd class="col-sm-9">@Model.Priority</dd>
</dl>

<div class="mt-3">
    @if (User.IsInRole("Admin"))
    {
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning me-2">Edit</a>
    <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger me-2">Delete</a>
    }

    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>
